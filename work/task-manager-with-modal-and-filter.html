<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Manager</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background-color: #f0f0f0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }

    th {
      background-color: #eee;
    }

    tr {
      height: 48px;
      transition: box-shadow 0.2s ease;
    }

    tr.drag-over {
      box-shadow: inset 0 0 0 2px #007bff;
    }

    .drag-handle {
      cursor: grab;
      font-size: 18px;
      color: #666;
    }

    .drag-handle:hover {
      color: #007bff;
    }

    select {
      width: 100%;
    }

    input[type="text"] {
      width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>

<body>
  <h1>Task Manager</h1>
  <table>
    <thead>
      <tr>
        <th>Drag</th>
        <th>#</th>
        <th>Task Name</th>
        <th>Group Type</th>
      </tr>
    </thead>
    <tbody id="taskTable"></tbody>
  </table>
  <br />
  <button onclick="addTask()">Add Task</button>

  <script>
    let tasks = [
      { name: "Independent A", group: "group-independent" },
      { name: "Independent B", group: "group-independent" },
      { name: "Independent C", group: "group-independent" },
      { name: "Sequential A", group: "group-sequential" },
      { name: "Sequential B", group: "group-sequential" },
      { name: "Parallel A", group: "group-parallel" },
      { name: "Parallel B", group: "group-parallel" },
      { name: "Independent D", group: "group-independent" },
    ];

    function renderTable() {
      const tbody = document.getElementById("taskTable");
      tbody.innerHTML = "";

      // Assign numbers based on grouping
      let number = 1;
      for (let i = 0; i < tasks.length; i++) {
        const current = tasks[i];
        const prev = tasks[i - 1];
        const next = tasks[i + 1];

        if (current.group === "group-sequential") {
          if (!prev || prev.group !== "group-sequential") {
            current.number = `${number}.1`;
            let sub = 2;
            let j = i + 1;
            while (j < tasks.length && tasks[j].group === "group-sequential") {
              tasks[j].number = `${number}.${sub++}`;
              j++;
            }
            i = j - 1;
            number++;
            continue;
          }
        } else if (current.group === "group-parallel") {
          if (!prev || prev.group !== "group-parallel") {
            current.number = number;
            let j = i + 1;
            while (j < tasks.length && tasks[j].group === "group-parallel") {
              tasks[j].number = number;
              j++;
            }
            i = j - 1;
            number++;
            continue;
          }
        } else {
          current.number = number++;
        }
      }

      // Render rows
      tasks.forEach((task, i) => {
        const row = document.createElement("tr");
        row.draggable = true;

        row.ondragstart = (e) => {
          e.dataTransfer.setData("text/plain", i);
          row.classList.add("drag-over");
        };

        row.ondragover = (e) => {
          e.preventDefault();
          row.classList.add("drag-over");
        };

        row.ondragleave = () => {
          row.classList.remove("drag-over");
        };

        row.ondrop = (e) => {
          const from = +e.dataTransfer.getData("text/plain");
          const to = i;
          if (from !== to) {
            const moved = tasks.splice(from, 1)[0];
            tasks.splice(to, 0, moved);
            renderTable();
          }
        };

        row.ondragend = () => {
          row.classList.remove("drag-over");
        };

        row.innerHTML = `
          <td class="drag-handle">&#x2630;</td>
          <td>${task.number}</td>
          <td><input type="text" value="${task.name}" onchange="tasks[${i}].name = this.value" /></td>
          <td>
            <select onchange="tasks[${i}].group = this.value; renderTable()">
              <option value="group-independent" ${task.group === "group-independent" ? "selected" : ""}>Independent</option>
              <option value="group-sequential" ${task.group === "group-sequential" ? "selected" : ""}>Sequential</option>
              <option value="group-parallel" ${task.group === "group-parallel" ? "selected" : ""}>Parallel</option>
            </select>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function addTask() {
      tasks.push({ name: "New Task", group: "group-independent" });
      renderTable();
    }

    renderTable();
  </script>
</body>

</html>