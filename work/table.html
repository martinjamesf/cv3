<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Manager – Bulk Edit + Drag</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      padding: 2rem;
      background: #f9f9f9;
      color: #222;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    th, td {
      padding: 1rem;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #f1f1f1;
      text-align: left;
    }

    tr.selected {
      background: #e6f2ff;
    }

    tr.group-independent td {
      border-left: 4px solid #4caf50;
    }

    tr.group-sequential td {
      border-left: 4px solid #2196f3;
    }

    tr.group-parallel td {
      border-left: 4px solid #ff9800;
    }

    .bulk-actions {
      display: none;
      background: #ffffff;
      color: #333;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .bulk-actions.visible {
      display: flex;
    }

    .action-btn,
    select,
    input[type="text"] {
      padding: 0.5rem 0.75rem;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #f7f7f7;
      cursor: pointer;
    }

    .action-btn:hover,
    select:hover {
      background: #eaeaea;
    }

    select {
      min-width: 160px;
    }

    .action-btn:active {
      background: #ddd;
    }

    #addTaskBtn {
      margin: 1rem 0;
    }

    .drag-handle {
      cursor: grab;
      display: inline-block;
      margin-right: 0.5rem;
      font-size: 1.2rem;
      user-select: none;
      color: #aaa;
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.3);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 1.5rem;
      border-radius: 6px;
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .modal.show {
      display: flex;
    }

    .modal-content button {
      align-self: flex-end;
    }
  </style>
</head>
<body>

  <div id="bulkActions" class="bulk-actions">
    <span>Bulk Actions:</span>
    <select id="groupSelect">
      <option value="">Move to Group...</option>
      <option value="group-independent">Independent</option>
      <option value="group-sequential">Sequential</option>
      <option value="group-parallel">Parallel</option>
    </select>
    <select id="statusSelect">
      <option value="">Change Status...</option>
      <option>To Do</option>
      <option>In Progress</option>
      <option>Done</option>
    </select>
    <button class="action-btn" id="deleteSelected">Delete</button>
  </div>

  <button class="action-btn" id="addTaskBtn">+ Add Task</button>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll" /></th>
        <th>Task</th>
        <th>Status</th>
        <th>Group</th>
      </tr>
    </thead>
    <tbody id="taskTable"></tbody>
  </table>

  <!-- Modal -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <label>
        Task Name:
        <input type="text" id="newTaskName">
      </label>
      <label>
        Status:
        <select id="newTaskStatus">
          <option>To Do</option>
          <option>In Progress</option>
          <option>Done</option>
        </select>
      </label>
      <label>
        Group:
        <select id="newTaskGroup">
          <option value="group-independent">Independent</option>
          <option value="group-sequential">Sequential</option>
          <option value="group-parallel">Parallel</option>
        </select>
      </label>
      <div style="display: flex; justify-content: space-between;">
        <button class="action-btn" onclick="closeModal()">Cancel</button>
        <button class="action-btn" onclick="addTask()">Add</button>
      </div>
    </div>
  </div>

  <script>
    const taskTable = document.getElementById('taskTable');
    const selectAll = document.getElementById('selectAll');
    const bulkActions = document.getElementById('bulkActions');
    const groupSelect = document.getElementById('groupSelect');
    const statusSelect = document.getElementById('statusSelect');
    const deleteBtn = document.getElementById('deleteSelected');
    const addTaskBtn = document.getElementById('addTaskBtn');

    const modal = document.getElementById('taskModal');
    const newTaskName = document.getElementById('newTaskName');
    const newTaskStatus = document.getElementById('newTaskStatus');
    const newTaskGroup = document.getElementById('newTaskGroup');

    let tasks = [];
    let draggedIndex = null;

    function saveTasks() {
      localStorage.setItem('taskList', JSON.stringify(tasks));
    }

    function loadTasks() {
      const stored = localStorage.getItem('taskList');
      tasks = stored ? JSON.parse(stored) : [
        { name: 'Write copy for homepage', status: 'In Progress', group: 'group-independent' },
        { name: 'Design wireframes', status: 'To Do', group: 'group-sequential' },
        { name: 'Prototype in Figma', status: 'To Do', group: 'group-sequential' },
        { name: 'Develop backend API', status: 'In Progress', group: 'group-parallel' },
        { name: 'Develop frontend UI', status: 'In Progress', group: 'group-parallel' }
      ];
    }

    function renderTable() {
      taskTable.innerHTML = '';
      tasks.forEach((task, index) => {
        const row = document.createElement('tr');
        row.classList.add(task.group);
        row.setAttribute('draggable', true);
        row.setAttribute('data-index', index);

        row.innerHTML = `
          <td>
            <span class="drag-handle" title="Drag to reorder">⋮⋮</span>
            <input type="checkbox" class="task-checkbox" data-index="${index}" />
          </td>
          <td>${task.name}</td>
          <td>${task.status}</td>
          <td>${task.group.replace('group-', '').replace('-', ' ')}</td>
        `;

        row.addEventListener('dragstart', handleDragStart);
        row.addEventListener('dragover', handleDragOver);
        row.addEventListener('drop', handleDrop);
        row.addEventListener('dragend', handleDragEnd);

        taskTable.appendChild(row);
      });
      bindCheckboxes();
    }

    function bindCheckboxes() {
      const checkboxes = document.querySelectorAll('.task-checkbox');
      checkboxes.forEach(cb => cb.addEventListener('change', updateBulkActions));
    }

    function updateBulkActions() {
      const selected = document.querySelectorAll('.task-checkbox:checked');
      bulkActions.classList.toggle('visible', selected.length > 0);

      document.querySelectorAll('#taskTable tr').forEach((row, index) => {
        row.classList.toggle('selected', selected[index]?.checked);
      });
    }

    selectAll.addEventListener('change', (e) => {
      const checkboxes = document.querySelectorAll('.task-checkbox');
      checkboxes.forEach(cb => cb.checked = e.target.checked);
      updateBulkActions();
    });

    groupSelect.addEventListener('change', () => {
      if (!groupSelect.value) return;
      document.querySelectorAll('.task-checkbox:checked').forEach(cb => {
        const index = parseInt(cb.dataset.index);
        tasks[index].group = groupSelect.value;
      });
      saveTasks();
      renderTable();
      groupSelect.value = '';
    });

    statusSelect.addEventListener('change', () => {
      if (!statusSelect.value) return;
      document.querySelectorAll('.task-checkbox:checked').forEach(cb => {
        const index = parseInt(cb.dataset.index);
        tasks[index].status = statusSelect.value;
      });
      saveTasks();
      renderTable();
      statusSelect.value = '';
    });

    deleteBtn.addEventListener('click', () => {
      tasks = tasks.filter((task, index) => {
        const cb = document.querySelector(`.task-checkbox[data-index="${index}"]`);
        return !cb || !cb.checked;
      });
      saveTasks();
      renderTable();
    });

    addTaskBtn.addEventListener('click', () => {
      modal.classList.add('show');
    });

    function closeModal() {
      modal.classList.remove('show');
      newTaskName.value = '';
    }

    function addTask() {
      if (!newTaskName.value.trim()) return;
      tasks.push({
        name: newTaskName.value.trim(),
        status: newTaskStatus.value,
        group: newTaskGroup.value
      });
      saveTasks();
      renderTable();
      closeModal();
    }

    // Drag logic for multi-select
    function handleDragStart(e) {
      draggedIndex = parseInt(this.dataset.index);
      e.dataTransfer.effectAllowed = 'move';
      this.style.opacity = '0.5';
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      this.style.borderTop = '2px dashed #4caf50';
    }

    function handleDrop(e) {
      e.preventDefault();
      const dropIndex = parseInt(this.dataset.index);

      const selectedIndexes = [...document.querySelectorAll('.task-checkbox:checked')]
        .map(cb => parseInt(cb.dataset.index))
        .sort((a, b) => a - b);

      const movingTasks = selectedIndexes.map(i => tasks[i]);
      tasks = tasks.filter((_, i) => !selectedIndexes.includes(i));

      tasks.splice(dropIndex, 0, ...movingTasks);
      saveTasks();
      renderTable();
    }

    function handleDragEnd(e) {
      draggedIndex = null;
      this.style.opacity = '';
      document.querySelectorAll('#taskTable tr').forEach(row => {
        row.style.borderTop = '';
      });
    }

    // Init
    loadTasks();
    renderTable();
  </script>
</body>
</html>
