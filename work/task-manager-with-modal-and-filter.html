<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .btn {
      padding: 0.5rem 1rem;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    .btn[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      vertical-align: middle;
    }
    input[type="text"], select {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .drag-handle {
      cursor: move;
      font-weight: bold;
      padding-right: 8px;
      color: #888;
    }
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      min-width: 300px;
    }
    .dropdown {
      position: relative;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      z-index: 1;
      min-width: 200px;
    }
    .dropdown-content a {
      display: block;
      padding: 0.5rem 1rem;
      text-decoration: none;
      color: #333;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }
    .bulk-actions {
      display: none;
      margin-bottom: 1rem;
      padding: 0.5rem;
      background: #f5f5f5;
      border: 1px solid #ccc;
      border-radius: 4px;
      gap: 0.75rem;
      align-items: center;
    }
    .bulk-actions.show {
      display: flex;
    }
    .number-column {
      white-space: nowrap;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="actions">
    <button id="addTask" class="btn">Add Task</button>

    <div class="dropdown">
      <button class="btn">Apply Workflow</button>
      <div class="dropdown-content">
        <a href="#" data-template="Risk Policy Opening">Risk Policy Opening</a>
        <a href="#" data-template="Wealth Account Opening">Wealth Account Opening</a>
      </div>
    </div>

    <button id="importTasks" class="btn">Import</button>
    <input type="file" id="importInput" style="display:none">
    <button id="editToggle" class="btn">Edit</button>
  </div>

  <div id="bulkActions" class="bulk-actions">
    <select id="bulkGroup" class="btn">
      <option disabled selected>Group by</option>
      <option value="Independent">Set Independent</option>
      <option value="Sequential">Set Sequential</option>
      <option value="Parallel">Set Parallel</option>
    </select>

    <select id="bulkStatus" class="btn">
      <option disabled selected>Status</option>
      <option value="Not Started">Mark Not Started</option>
      <option value="In Progress">Mark In Progress</option>
      <option value="Completed">Mark Completed</option>
      <option value="Waiting on Someone">Mark Waiting</option>
    </select>

    <button id="deleteSelected" class="btn">Delete</button>
  </div>

  <table id="taskTable">
    <thead>
      <tr>
        <th></th>
        <th></th>
        <th>#</th>
        <th>Task Name</th>
        <th>Status</th>
        <th>Group</th>
        <th>Task Creation Sequence</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="taskModal" class="modal">
    <div class="modal-content">
      <p id="modalTaskName"></p>
      <button onclick="closeModal()" class="btn">Close</button>
    </div>
  </div>

  <script>
    const taskTable = document.querySelector("#taskTable tbody");
    const bulkActions = document.getElementById("bulkActions");
    const editToggle = document.getElementById("editToggle");
    let editMode = true;

    const workflowTemplates = {
      "Risk Policy Opening": [
        "Gather client information",
        "Send client online medical",
        "Complete Application",
        "Send to client for eSign",
        "Submit to underwriting",
        "Delivery policy"
      ],
      "Wealth Account Opening": [
        "Initial client consultation",
        "Risk profiling",
        "Create investment strategy",
        "Compliance documentation",
        "Account funding",
        "Portfolio deployment"
      ]
    };

    function addTask(name = "") {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td><input type="checkbox" class="rowCheck"></td>
        <td class="drag-handle">â˜°</td>
        <td class="number-column"></td>
        <td class="task-name-cell">
          <span class="task-link">${name}</span>
          <input type="text" class="task-input" value="${name}" style="display:none">
        </td>
        <td>
          <select class="status-input">
            <option>Not Started</option>
            <option>In Progress</option>
            <option>Completed</option>
            <option>Waiting on Someone</option>
          </select>
        </td>
        <td>
          <select class="group-input">
            <option>Independent</option>
            <option>Sequential</option>
            <option>Parallel</option>
          </select>
        </td>
        <td><input type="text" class="sequence-input" /></td>
      `;

      taskTable.appendChild(row);
      addDragHandlers();
      updateNumbering();
      saveTasksToLocalStorage();
    }

    document.getElementById("addTask").addEventListener("click", () => addTask(""));

    document.querySelectorAll('.dropdown-content a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const template = e.target.dataset.template;
        workflowTemplates[template].forEach(name => addTask(name));
      });
    });

    document.getElementById("importTasks").addEventListener("click", () => {
      document.getElementById("importInput").click();
    });

    document.getElementById("importInput").addEventListener("change", (e) => {
      const reader = new FileReader();
      reader.onload = function () {
        const data = JSON.parse(reader.result);
        taskTable.innerHTML = "";
        data.forEach(task => addTask(task.name));
      };
      reader.readAsText(e.target.files[0]);
    });

    editToggle.addEventListener("click", () => {
      editMode = !editMode;
      editToggle.textContent = editMode ? "Edit" : "Save";
      [...document.querySelectorAll(".task-link")].forEach(span => span.style.display = editMode ? "none" : "inline");
      [...document.querySelectorAll(".task-input")].forEach(input => input.style.display = editMode ? "inline" : "none");
    });

    function closeModal() {
      document.getElementById("taskModal").style.display = "none";
    }

    document.addEventListener("click", e => {
      if (e.target.classList.contains("task-link") && !editMode) {
        document.getElementById("modalTaskName").textContent = e.target.textContent;
        document.getElementById("taskModal").style.display = "flex";
      }
    });

    taskTable.addEventListener("change", e => {
      if (e.target.classList.contains("rowCheck")) {
        const anyChecked = document.querySelectorAll(".rowCheck:checked").length > 0;
        bulkActions.classList.toggle("show", anyChecked);
      }
      updateNumbering();
      saveTasksToLocalStorage();
    });

    document.getElementById("bulkGroup").addEventListener("change", e => {
      const value = e.target.value;
      document.querySelectorAll(".rowCheck:checked").forEach(cb => {
        cb.closest("tr").querySelector(".group-input").value = value;
      });
      updateNumbering();
    });

    document.getElementById("bulkStatus").addEventListener("change", e => {
      const value = e.target.value;
      document.querySelectorAll(".rowCheck:checked").forEach(cb => {
        cb.closest("tr").querySelector(".status-input").value = value;
      });
      saveTasksToLocalStorage();
    });

    document.getElementById("deleteSelected").addEventListener("click", () => {
      document.querySelectorAll(".rowCheck:checked").forEach(cb => cb.closest("tr").remove());
      bulkActions.classList.remove("show");
      updateNumbering();
      saveTasksToLocalStorage();
    });

    function updateNumbering() {
      const rows = [...taskTable.querySelectorAll("tr")];
      let groupIndex = 0, subIndex = 1, previousGroup = "";
      rows.forEach(row => {
        const group = row.querySelector(".group-input").value;
        if (group === "Sequential") {
          if (previousGroup !== "Sequential") {
            groupIndex++;
            subIndex = 1;
          }
          row.querySelector(".number-column").textContent = `${groupIndex}.${subIndex++}`;
        } else if (group === "Parallel") {
          if (previousGroup !== "Parallel") groupIndex++;
          row.querySelector(".number-column").textContent = `${groupIndex}`;
        } else {
          groupIndex++;
          row.querySelector(".number-column").textContent = `${groupIndex}`;
        }
        previousGroup = group;
      });
    }

    function saveTasksToLocalStorage() {
      const tasks = [...taskTable.querySelectorAll("tr")].map(row => {
        return {
          name: row.querySelector(".task-input").value,
          status: row.querySelector(".status-input").value,
          group: row.querySelector(".group-input").value,
          sequence: row.querySelector(".sequence-input").value
        };
      });
      localStorage.setItem("tasks", JSON.stringify(tasks));
    }

    function loadTasksFromLocalStorage() {
      const data = JSON.parse(localStorage.getItem("tasks") || "[]");
      taskTable.innerHTML = "";
      data.forEach(task => addTask(task.name));
    }

    function addDragHandlers() {
      let draggedRow;
      taskTable.querySelectorAll(".drag-handle").forEach(handle => {
        const row = handle.closest("tr");
        handle.draggable = true;
        handle.addEventListener("dragstart", () => draggedRow = row);
        handle.addEventListener("dragover", e => e.preventDefault());
        handle.addEventListener("drop", () => {
          if (draggedRow !== row) {
            taskTable.insertBefore(draggedRow, row.nextSibling);
            updateNumbering();
            saveTasksToLocalStorage();
          }
        });
      });
    }

    loadTasksFromLocalStorage();
  </script>
</body>
</html>
