<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Table</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f7f7f7;
    }

    .table-container {
      overflow-x: auto;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    th,
    td {
      border-bottom: 1px solid #ddd;
      padding: 8px 10px;
      text-align: left;
      vertical-align: middle;
      height: 48px;
    }

    th {
      background: #f0f0f0;
      font-weight: bold;
    }

    td input[type="text"],
    td select,
    td input[type="number"] {
      width: 100%;
      padding: 4px 6px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .drag-handle {
      cursor: move;
      margin-right: 8px;
    }

    .bulk-actions {
      display: none;
      margin-bottom: 0.5rem;
      gap: 1rem;
      align-items: center;
    }

    .bulk-actions.active {
      display: flex;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      gap: 1rem;
    }

    .action-buttons {
      display: flex;
      gap: 0.75rem;
    }

    .bulk-actions select,
    .bulk-actions button {
      margin-right: 0.5rem;
    }

    .btn {
      padding: 6px 12px;
      font-size: 14px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn:hover {
      background: #0056b3;
    }

    .flex {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .edit-toggle {
      float: right;
    }

    a.task-link {
      color: #007bff;
      cursor: pointer;
      text-decoration: underline;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
      background: white;
      margin: 10% auto;
      padding: 1rem;
      width: 400px;
      border-radius: 8px;
    }

    .modal-close {
      float: right;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <div class="top-bar">
    <div class="action-buttons">
      <button class="btn" onclick="addTask()">Add Task</button>
      <button class="btn" onclick="applyWorkflow()">Apply Workflows</button>
      <button class="btn edit-toggle" onclick="toggleEdit()">
        <span id="editToggleText">Edit</span>
      </button>
    </div>
    <div class="bulk-actions" id="bulkActions">
      <select id="bulkGroup" onchange="applyBulkGroup(this.value)">
        <option value="">Group by</option>
        <option value="Independent">Independent</option>
        <option value="Sequential">Sequential</option>
        <option value="Parallel">Parallel</option>
      </select>

      <select id="bulkStatus" onchange="applyBulkStatus(this.value)">
        <option value="">Status</option>
        <option value="Not Started">Not Started</option>
        <option value="In Progress">In Progress</option>
        <option value="Completed">Completed</option>
        <option value="Waiting on Someone">Waiting on Someone</option>
      </select>

      <button class="btn" onclick="deleteSelected()">Delete</button>
    </div>
  </div>


  <div class="table-container">
    <table id="taskTable">
      <thead>
        <tr>
          <th></th>
          <th>#</th>
          <th>Task Name</th>
          <th>Status</th>
          <th>Group</th>
          <th>Task Creation Sequence</th>
        </tr>
      </thead>
      <tbody id="taskBody"></tbody>
    </table>
  </div>

  <!-- Modal -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">×</span>
      <h3>Edit Task</h3>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
    let editing = false;

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      render();
    }

    function render() {
      const tbody = document.getElementById("taskBody");
      tbody.innerHTML = "";

      let numbering = [];
      let currentGroup = null;
      let groupCount = 0;
      let seqSub = 1;

      tasks.forEach((task, index) => {
        const prev = tasks[index - 1];
        const next = tasks[index + 1];
        let number = "";

        if (task.group === "Sequential") {
          if (!prev || prev.group !== "Sequential") {
            groupCount++;
            seqSub = 1;
          }
          number = `${groupCount}.${seqSub++}`;
        } else if (task.group === "Parallel") {
          if (!prev || prev.group !== "Parallel") groupCount++;
          number = groupCount;
        } else {
          groupCount++;
          number = groupCount;
        }

        const tr = document.createElement("tr");

        // Drag handle + checkbox
        const drag = document.createElement("td");
        drag.innerHTML = `<span class="drag-handle">☰</span> <input type="checkbox" onchange="toggleBulkActions()" data-index="${index}"/>`;
        tr.appendChild(drag);

        const tdNum = document.createElement("td");
        tdNum.textContent = number;
        tr.appendChild(tdNum);

        // Task Name
        const tdTask = document.createElement("td");
        if (editing) {
          const input = document.createElement("input");
          input.type = "text";
          input.value = task.name || "";
          input.onchange = e => { task.name = e.target.value; saveTasks(); };
          tdTask.appendChild(input);
        } else {
          const link = document.createElement("a");
          link.textContent = task.name || "Untitled";
          link.className = "task-link";
          link.onclick = () => openModal(index);
          tdTask.appendChild(link);
        }
        tr.appendChild(tdTask);

        // Status
        const tdStatus = document.createElement("td");
        if (editing) {
          const sel = document.createElement("select");
          ["Not Started", "In Progress", "Completed", "Waiting on Someone"].forEach(status => {
            const option = new Option(status, status, task.status === status, task.status === status);
            sel.appendChild(option);
          });
          sel.onchange = e => { task.status = e.target.value; saveTasks(); };
          tdStatus.appendChild(sel);
        } else {
          tdStatus.textContent = task.status || "Not Started";
        }
        tr.appendChild(tdStatus);

        // Group
        const tdGroup = document.createElement("td");
        if (editing) {
          const sel = document.createElement("select");
          ["Independent", "Sequential", "Parallel"].forEach(group => {
            const option = new Option(group, group, task.group === group, task.group === group);
            sel.appendChild(option);
          });
          sel.onchange = e => { task.group = e.target.value; saveTasks(); };
          tdGroup.appendChild(sel);
        } else {
          tdGroup.textContent = task.group || "Independent";
        }
        tr.appendChild(tdGroup);

        // Task Creation Sequence
        const tdCreate = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.value = task.creation || index + 1;
        input.onchange = e => { task.creation = parseInt(e.target.value, 10); saveTasks(); };
        tdCreate.appendChild(input);
        tr.appendChild(tdCreate);

        tbody.appendChild(tr);
      });
    }

    function addTask() {
      tasks.push({ name: "", status: "Not Started", group: "Independent", creation: tasks.length + 1 });
      saveTasks();
    }

    function applyWorkflow() {
      const steps = [
        "Gather client information",
        "Send client online medical",
        "Complete Application",
        "Send to client for eSign",
        "Submit to underwriting",
        "Delivery policy"
      ];
      steps.forEach(name => tasks.push({ name, status: "Not Started", group: "Independent", creation: tasks.length + 1 }));
      saveTasks();
    }

    function toggleEdit() {
      editing = !editing;
      document.getElementById("editToggleText").textContent = editing ? "Save" : "Edit";
      render();
    }

    function openModal(index) {
      const modal = document.getElementById("taskModal");
      const content = document.getElementById("modalContent");
      const task = tasks[index];
      content.innerHTML = `
        <label>Task Name:</label>
        <input type="text" value="${task.name}" onchange="tasks[${index}].name=this.value; saveTasks()" />
        <br/><br/>
        <label>Status:</label>
        <select onchange="tasks[${index}].status=this.value; saveTasks()">
          <option ${task.status === "Not Started" ? "selected" : ""}>Not Started</option>
          <option ${task.status === "In Progress" ? "selected" : ""}>In Progress</option>
          <option ${task.status === "Completed" ? "selected" : ""}>Completed</option>
          <option ${task.status === "Waiting on Someone" ? "selected" : ""}>Waiting on Someone</option>
        </select>
        <br/><br/>
        <label>Group:</label>
        <select onchange="tasks[${index}].group=this.value; saveTasks()">
          <option ${task.group === "Independent" ? "selected" : ""}>Independent</option>
          <option ${task.group === "Sequential" ? "selected" : ""}>Sequential</option>
          <option ${task.group === "Parallel" ? "selected" : ""}>Parallel</option>
        </select>
      `;
      modal.style.display = "block";
    }

    function closeModal() {
      document.getElementById("taskModal").style.display = "none";
    }

    function toggleBulkActions() {
      const checked = [...document.querySelectorAll("input[type=checkbox]:checked")];
      document.getElementById("bulkActions").classList.toggle("active", checked.length > 0);
    }

    function applyBulkGroup(group) {
      document.querySelectorAll("input[type=checkbox]:checked").forEach(cb => {
        const index = cb.dataset.index;
        tasks[index].group = group;
      });
      saveTasks();
    }

    function applyBulkStatus(status) {
      document.querySelectorAll("input[type=checkbox]:checked").forEach(cb => {
        const index = cb.dataset.index;
        tasks[index].status = status;
      });
      saveTasks();
    }

    function deleteSelected() {
      tasks = tasks.filter((_, i) => !document.querySelector(`input[type=checkbox][data-index="${i}"]`)?.checked);
      saveTasks();
    }

    render();
  </script>
</body>

</html>